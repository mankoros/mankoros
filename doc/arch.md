# 架构与物理内存管理

MankorOS 使用内核态与用户态共享的页表以避免在系统调用或时钟中断时冲刷TLB，以提高性能。

## 内存空间布局

MankorOS 的虚拟内存空间主要分为两段：用户段和内核段。
用户段位于虚拟地址空间的低地址，内核段位于虚拟地址空间的高地址。
根据SV39的规范，用户段39位以上均为0，内核段39以上均为1。
其中，内核的链接基地址为 0xFFFFFFFF80200000，在链接脚本 linker.ld 中设置

具体的内存空间布局如下表：

用户程序映像：        0x0000_0000_0001_0000 ~ 0x0000_0000_4000_0000
用户堆：             0x0000_0000_4000_0000 ~ 0x0000_0000_8000_0000
用户栈：             0x0000_0001_0000_0000 ~ 0x0000_0002_0000_0000
用户MMAP：           0x0000_0002_0000_0000 ~ 0x0000_0004_0000_0000

内核物理内存直接映射：  0xffff_fff0_0000_0000 ~ 0xffff_ffff_8000_0000
内核映像：            0xffff_ffff_8000_0000 ~ 0xffff_ffff_c000_0000
硬件MMIO：            0xffff_ffff_c000_0000 ~ 0xffff_ffff_f000_0000


## 物理页分配

<!-- TODO: buddy_frame_allocator -->

## 页表管理

### 启动阶段

<!-- TODO: 描述一下页表的数据结构 -->
<!-- TODO: 页表物理页管理 -->

## 共享物理页管理

<!-- TODO: shared_frame_mgr.rs -->